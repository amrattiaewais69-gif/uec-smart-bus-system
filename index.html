<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>University of East Capital</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
body{
  background:#0b1c2d;
  color:white;
  font-family:Arial;
  text-align:center;
}
.box{
  border:3px solid gold;
  padding:20px;
  margin:20px;
  border-radius:15px;
}
.status{
  font-size:22px;
  margin-top:15px;
}
.footer{
  margin-top:50px;
  font-size:12px;
  color:#ccc;
}
button{
  padding:10px 20px;
  margin:10px;
}
</style>
</head>
<body>

<h1>University of East Capital2</h1>

<div class="box">
Driver Name: <input id="driver"><br><br>
Bus Number: <input id="bus"><br><br>
<button onclick="startScan(); unlockAudio();">Start Scan</button>
</div>

<div id="reader" style="width:300px;margin:auto;"></div>
<div class="status" id="status"></div>

<div class="footer">
Designed by UEC ICT Department<br>
Â© 2026 University of East Capital. All Rights Reserved.
</div>

<script>

const scriptURL = "https://script.google.com/macros/s/AKfycbw-G-TCGtuBDT-TbOE3Lrs9toH48WHhL2NWq6wi183qlICL7Ypmt_1R21L_elNfq4rl/exec";

function startScan(){
  const driver = document.getElementById("driver").value;
  const bus = document.getElementById("bus").value;

  const qr = new Html5Qrcode("reader");
  qr.start({ facingMode: "environment" }, {
    fps: 10,
    qrbox: 250
  }, async (decodedText) => {

    const data = JSON.parse(decodedText);

    const res = await fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify({
        studentId: data.id,
        studentName: data.name,
        college: data.college,
        driverName: driver,
        busNumber: bus
      })
    });

    const result = await res.json();
    document.getElementById("status").innerHTML =
  result.status.toUpperCase() + "<br>" + result.message;

if(result.status === "approved"){
  document.getElementById("successSound").play();
}
else{
  document.getElementById("errorSound").play();
}

  });
}
function unlockAudio(){
  const s = document.getElementById("successSound");
  const e = document.getElementById("errorSound");
  s.play().then(()=>{ s.pause(); s.currentTime=0; });
  e.play().then(()=>{ e.pause(); e.currentTime=0; });
}
</script>
<audio id="successSound" src="https://assets.mixkit.co/sfx/preview/mixkit-positive-interface-beep-221.mp3"></audio>
<audio id="errorSound" src="https://assets.mixkit.co/sfx/preview/mixkit-interface-wrong-2572.mp3"></audio>
</body>
</html>
