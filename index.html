<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>University of East Capital - Executive Bus System</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>

:root{
  --gold:#d4af37;
  --dark:#081424;
  --dark2:#0a1a2f;
  --success:#00ff88;
  --danger:#ff4444;
}

*{
  box-sizing:border-box;
}

body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(180deg,var(--dark),var(--dark2));
  color:white;
  text-align:center;
  overflow-x:hidden;
}

/* Header */

header{
  padding:20px;
  font-size:clamp(20px,4vw,32px);
  font-weight:bold;
  color:var(--gold);
  border-bottom:2px solid var(--gold);
  letter-spacing:1px;
}

/* Road Section */

.road-container{
  position:relative;
  height:140px;
  margin-top:10px;
  overflow:hidden;
}

.road{
  position:absolute;
  bottom:25px;
  width:200%;
  height:6px;
  background:repeating-linear-gradient(
    90deg,
    var(--gold) 0px,
    var(--gold) 50px,
    transparent 50px,
    transparent 100px
  );
  animation:roadMove 2s linear infinite;
}

@keyframes roadMove{
  from{ transform:translateX(0); }
  to{ transform:translateX(-100px); }
}

.bus{
  position:absolute;
  bottom:35px;
  left:-120px;
  font-size:clamp(40px,6vw,65px);
  animation:busDrive 8s linear infinite;
}

@keyframes busDrive{
  0%{ left:-150px; }
  100%{ left:110%; }
}

/* Card Style */

.card{
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(10px);
  border:1px solid rgba(212,175,55,0.3);
  border-radius:15px;
  padding:20px;
  width:90%;
  max-width:420px;
  margin:20px auto;
  box-shadow:0 0 25px rgba(212,175,55,0.2);
}

/* Scanner */

#reader{
  width:100%;
  max-width:380px;
  margin:20px auto;
  border:3px solid var(--gold);
  border-radius:15px;
  padding:10px;
  box-shadow:0 0 20px rgba(212,175,55,0.4);
  transition:0.4s;
}

#reader.approved-glow{
  box-shadow:0 0 35px var(--success);
}

#reader.error-glow{
  box-shadow:0 0 35px var(--danger);
}

/* Overlay */

#resultOverlay{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  font-size:clamp(26px,5vw,44px);
  font-weight:bold;
  opacity:0;
  pointer-events:none;
  transition:0.4s;
  z-index:9999;
  text-align:center;
  padding:20px;
}

#resultOverlay.show{ opacity:1; }

#resultOverlay.approved{
  background:radial-gradient(circle,#0f5132,var(--dark));
}

#resultOverlay.rejected{
  background:radial-gradient(circle,#5a0f0f,var(--dark));
}

/* Inputs */

input{
  padding:14px;
  margin:10px 0;
  border-radius:10px;
  border:none;
  width:100%;
  font-size:16px;
}

button{
  padding:14px;
  border:none;
  border-radius:10px;
  background:var(--gold);
  color:var(--dark2);
  font-weight:bold;
  cursor:pointer;
  width:100%;
  font-size:16px;
  transition:0.3s;
}

button:hover{
  transform:scale(1.05);
}

/* Counter */

.counter{
  color:var(--gold);
  margin-top:10px;
  font-size:18px;
}

/* Footer */

footer{
  margin-top:40px;
  padding:15px;
  font-size:clamp(12px,2vw,14px);
  border-top:2px solid var(--gold);
  color:#ccc;
}

/* Gold Explosion */

.particle{
  position:absolute;
  width:8px;
  height:8px;
  background:var(--gold);
  border-radius:50%;
  animation:explode 1s forwards;
}

@keyframes explode{
  to{
    transform:translate(var(--x),var(--y));
    opacity:0;
  }
}

/* Mobile Tweaks */

@media(max-width:600px){

  .road-container{
    height:110px;
  }

  .bus{
    animation:busDrive 10s linear infinite;
  }

}

</style>
</head>

<body>

<header>
ðŸŽ“ University of East Capital<br>
Executive Bus Access System
</header>

<div class="road-container">
  <div class="bus">ðŸšŒ</div>
  <div class="road"></div>
</div>

<div id="loginSection" class="card">
  <h3>Driver Login</h3>
  <input type="text" id="driver" placeholder="Driver Name">
  <input type="text" id="bus" placeholder="Bus Number">
  <button onclick="startSystem()">Start System</button>
</div>

<div id="scanSection" style="display:none;">
  <h3 id="sessionInfo"></h3>
  <div id="reader"></div>
  <div id="status"></div>
  <div class="counter">Students Count: <span id="count">0</span></div>
</div>

<footer>
Designed by UEC ICT Department<br>
Â© 2026 University of East Capital. All Rights Reserved.
</footer>

<div id="resultOverlay"></div>

<script>

const scriptURL="https://script.google.com/macros/s/AKfycbw-G-TCGtuBDT-TbOE3Lrs9toH48WHhL2NWq6wi183qlICL7Ypmt_1R21L_elNfq4rl/exec";

let studentCount=0;
let qr;
let isProcessing=false;
let lastScannedId=null;

function startSystem(){

  const driver=document.getElementById("driver").value;
  const bus=document.getElementById("bus").value;

  if(!driver||!bus){
    alert("Enter Driver Name & Bus Number");
    return;
  }

  document.getElementById("loginSection").style.display="none";
  document.getElementById("scanSection").style.display="block";

  document.getElementById("sessionInfo").innerHTML=
    "Driver: "+driver+" | Bus: "+bus+"<br>"+new Date().toLocaleString();

  qr=new Html5Qrcode("reader");
  qr.start({facingMode:"environment"},{fps:10,qrbox:250},onScanSuccess);
}

async function onScanSuccess(decodedText){

  if(isProcessing) return;

  let data;
  try{ data=JSON.parse(decodedText); }
  catch{ return; }

  if(data.id===lastScannedId) return;

  isProcessing=true;
  lastScannedId=data.id;
  qr.pause();

  const response=await fetch(scriptURL,{
    method:"POST",
    body:JSON.stringify({
      studentId:data.id,
      studentName:data.name,
      college:data.college,
      driverName:driver.value,
      busNumber:bus.value
    })
  });

  const result=await response.json();

  document.getElementById("status").innerHTML=
    result.status.toUpperCase()+"<br>"+result.message;

  showOverlay(result.status,result.message);

  if(result.status==="approved"){
    studentCount++;
    document.getElementById("count").innerText=studentCount;
    playSuccess();
    goldExplosion();
  }else{
    playError();
  }

  setTimeout(()=>{
    qr.resume();
    isProcessing=false;
  },1000);
}

/* Overlay */

function showOverlay(type,message){

  const overlay=document.getElementById("resultOverlay");
  const reader=document.getElementById("reader");

  overlay.className="";
  overlay.classList.add("show",type);
  overlay.innerHTML=type.toUpperCase()+"<br>"+message;

  if(type==="approved"){
    reader.classList.add("approved-glow");
  }else{
    reader.classList.add("error-glow");
  }

  setTimeout(()=>{
    overlay.className="";
    reader.classList.remove("approved-glow","error-glow");
  },1500);
}

/* Gold Explosion */

function goldExplosion(){
  for(let i=0;i<20;i++){
    const p=document.createElement("div");
    p.className="particle";
    p.style.setProperty('--x',(Math.random()*400-200)+"px");
    p.style.setProperty('--y',(Math.random()*400-200)+"px");
    p.style.left="50%";
    p.style.top="50%";
    document.body.appendChild(p);
    setTimeout(()=>p.remove(),1000);
  }
}

/* Sound */

function playSuccess(){
  const ctx=new (window.AudioContext||window.webkitAudioContext)();
  const o=ctx.createOscillator();
  const g=ctx.createGain();
  o.type="sine";
  o.frequency.value=900;
  o.connect(g);
  g.connect(ctx.destination);
  g.gain.setValueAtTime(0.5,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.6);
  o.start();
  o.stop(ctx.currentTime+0.6);
}

function playError(){
  const ctx=new (window.AudioContext||window.webkitAudioContext)();
  const o=ctx.createOscillator();
  const g=ctx.createGain();
  o.type="triangle";
  o.frequency.value=220;
  o.connect(g);
  g.connect(ctx.destination);
  g.gain.setValueAtTime(0.4,ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.8);
  o.start();
  o.stop(ctx.currentTime+0.8);
}

</script>

</body>
</html>
